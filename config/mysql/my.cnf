[mysqld]
# --------------------------- 네트워크 -------------------------------
port = 3306                # ▶️ 수신 포트 / 💠 3306
bind-address = 0.0.0.0     # ▶️ 전 인터페이스 바인드 / 💠 127.0.0.1
socket = /var/lib/mysql/mysql.sock  # ▶️ 유닉스 소켓 경로 (기존 설정 유지)
datadir = /var/lib/mysql    # ▶️ 데이터 파일 위치 / 💠 /var/lib/mysql
pid-file=/var/run/mysqld/mysqld.pid

# --------------------------- 기본 설정 -------------------------------
# basedir = /usr/local/perconadb  # ▶️ MySQL 설치 경로 / 💠 컴파일 시 기본값 [1]
default-storage-engine = InnoDB  # ▶️ 기본 스토리지 엔진 / 💠 InnoDB [2]
# skip-external-locking      # ▶️ 외부 잠금 비활성화 (성능 향상) / 💠 OFF [2]
# explicit_defaults_for_timestamp = 1  # ▶️ TIMESTAMP 기본값 명시적 설정 / 💠 OFF [2]
# lc-messages-dir = '/usr/local/perconadb/share'  # ▶️ 오류 메시지 디렉토리 / 💠 설치 경로 기준 [2]

# --------------------------- 인증/보안 -------------------------------
# default_authentication_plugin = mysql_native_password  # ▶️ 로그인 플러그인 / 💠 mysql_native_password /caching_sha2_password
# default-authentication-plugin = mysql_native_password

# skip-name-resolve          # ▶️ DNS 역조회 비활성화 / 💠 OFF
# local_infile = 0           # ▶️ LOCAL DATA INFILE 비활성화 (보안) / 💠 1 [2]
log_bin_trust_function_creators = 1  # ▶️ Stored Function 생성 시 BINLOG 권한 회피
									 # 기본값 OFF, 권한 없는 함수 작성자 시투자 설정

# --------------------------- 메모리 -------------------------------
innodb_buffer_pool_size = 17G  # ▶️ Hot 데이터 캐시(≈RAM 70%) / 💠 128M
innodb_buffer_pool_instances = 4  # ▶️ 버퍼풀 파티셔닝(코어수 기준) / 💠 1
innodb_numa_interleave = OFF
# innodb_max_dirty_pages_pct = 90  # ▶️ Dirty 페이지 최대 비율 / 💠 90 [2]

# --------------------------- 로그 -------------------------------
innodb_log_file_size = 1G  # ▶️ REDO 로그 파일 크기 (MySQL 8.4 미사용 권장*) / 💠 128M
# innodb_redo_log_capacity = 3G  # ▶️ REDO 로그 총 용량 (8.0.30+ 대체 설정) / 💠 128M [1][4]
innodb_log_buffer_size = 64M  # ▶️ 트랜잭션 로그 버퍼 / 💠 16M
innodb_flush_log_at_trx_commit = 1  # ▶️ 1=완전 내구성 / 💠 1
innodb_flush_method = O_DIRECT  # ▶️ OS 캐시 우회 / 💠 fsync

# --------------------------- I/O -------------------------------
innodb_io_capacity = 1000  # ▶️ SSD 기대 IOPS / 💠 200
innodb_io_capacity_max = 2000  # ▶️ 피크 IOPS 상한 / 💠 2000
innodb_read_io_threads = 4  # ▶️ 읽기 스레드 / 💠 4
innodb_write_io_threads = 4  # ▶️ 쓰기 스레드 / 💠 4
innodb_file_per_table = 1    # ▶️ 개별 테이블스페이스 / 💠 1
# innodb_doublewrite = 1       # ▶️ InnoDB 스토리지 엔진의 데이터 파일 구성·동작 정책 지정
							 # 일반적으로 덜 사용하는 내부 옵션들, 고급 튜닝 목적

# --------------------------- 연결/타임아웃 -------------------------------
max_connections = 200       # ▶️ 동시 접속 한도 / 💠 151
# max_connect_errors = 9999999  # ▶️ 접속 실패 횟수 제한(디스크 용 host cache 무한 설정)
								# 기본값 10, 네트워크 불안정 환경 시 높게 설정
# wait_timeout = 3600         # ▶️ 비활성 연결 타임아웃(초) / 💠 28800 [2]
# interactive-timeout = 3600  # ▶️ 인터랙티브 세션 타임아웃(초) / 💠 28800 [2]
thread_cache_size = 20      # ▶️ 재사용 스레드 캐시 / 💠 10

# --------------------------- 임시·정렬 버퍼 -------------------------------
tmp_table_size = 256M       # ▶️ 메모리 임시테이블 한계 / 💠 16M
max_heap_table_size = 256M  # ▶️ HEAP 임시테이블 한계 / 💠 16M
join_buffer_size = 2M       # ▶️ 조인 버퍼 / 💠 256K
sort_buffer_size = 2M       # ▶️ 정렬 버퍼 / 💠 256K
read_buffer_size = 1M       # ▶️ 순차 읽기 버퍼 / 💠 128K
read_rnd_buffer_size = 1M   # ▶️ 랜덤 읽기 버퍼 / 💠 256K
table_open_cache = 2000     # ▶️ 열린 테이블 캐시 / 💠 2000
table_definition_cache = 1400  # ▶️ 테이블 정의 캐시 / 💠 1400

# --------------------------- 트랜잭션 -------------------------------
transaction-isolation = REPEATABLE-READ  # ▶️ 기본 격리 수준 / 💠 REPEATABLE-READ [2]
innodb_lock_wait_timeout = 50  # ▶️ 잠금 대기 시간(초) / 💠 50 [2]

# --------------------------- 로깅/모니터링 -------------------------------
log_error = /var/log/mysql/error.log  # ▶️ 에러 로그 경로
log_error_verbosity = 2
slow_query_log = ON         # ▶️ 슬로우 쿼리 로깅 / 💠 OFF
slow_query_log_file = /var/log/mysql/slow_query.log
long_query_time = 0.5       # ▶️ 슬로우 쿼리 기준(초) / 💠 10
innodb_print_all_deadlocks = 1  # ▶️ 데드락 로깅 활성화 / 💠 OFF [2]

# --------------------------- 문자셋 -------------------------------
character_set_server = utf8mb4  # ▶️ 서버 문자셋 / 💠 utf8mb4
collation_server = utf8mb4_unicode_ci  # ▶️ 서버 콜레이션 / 💠 utf8mb4_0900_ai_ci
init_connect='SET collation_connection = utf8mb4_general_ci; SET NAMES utf8mb4'

# --------------------------- 고급 -------------------------------
innodb_thread_concurrency = 0  # ▶️ InnoDB 스레드 동시성 (0=자동) / 💠 0 [2]
innodb_stats_on_metadata = 0   # ▶️ 메타데이터 접근 시 통계 갱신 비활성화 / 💠 OFF [2]
server-id = 1                # ▶️ 복제용 서버 ID (기본값 1) / 💠 0 [2]
